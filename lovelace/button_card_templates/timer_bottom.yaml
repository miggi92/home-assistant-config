---
#
custom_card_timer_bottom:
  template: setup
  type: custom:button-card
  entity: |
    [[[
      if (states["sensor.echo_show_next_timer"].state == "on") {
        return 'sensor.echo_show_next_timer'
      } else if (states["sensor.echo_schlafzimmer_next_timer"].state == "on") {
        return 'sensor.echo_schlafzimmer_next_timer'
      } else if (states["sensor.milos_dot_next_timer"].state == "on") {
        return 'sensor.milos_dot_next_timer'
      } else if (states["sensor.echo_kuche_next_timer"].state == "on") {
        return 'sensor.echo_kuche_next_timer'
      } else {
        return 'sensor.kitchen_timer'
      }
    ]]]
  show_name: true
  show_icon: false
  show_label: false
  show_state: false
  tap_action:
    action: more-info
  hold_action:
    action: more-info
  custom_fields:
    bar: |
      [[[
        var color = "var(--green)";
        var state = 100 - states[ entity.entity_id ].attributes.remaining_perc;
        if (state < 10) color = "var(--red)";
        else if (state < 50) color = "var(--yellow)";
        else if (state < 90) color = "var(--orange)";
        return `
        <div>
        <div style="background:${color}; height: 12px; width:${state}%">
        </div>
        </div>`
      ]]]
    rem:
      card:
        type: custom:button-card
        entity: "[[[ return entity.entity_id ]]]"
        name: |
          [[[
          var remainingTime = states[ entity.entity_id ].attributes.remaining;
          return `${remainingTime}`;
          ]]]
        show_icon: false
        styles:
          card:
            - width: min
            - background: none
            - overflow: visible
          name:
            - font-size: 14px
            - margin-top: 6px
            - font-weight: 600
            - color: var(--contrast20)
    icon1: |
      [[[
          return '<ha-icon icon="mdi:timer-outline"></ha-icon>';
      ]]]
  styles:
    grid:
      - grid-template-areas: '"rem icon1" "n icon2" "bar bar"'
      - grid-template-rows: min-content min-content min-content
      - grid-template-columns: 60% 40%
    card:
      - padding: 15px 35px 15px 35px
      - background: var(--contrast2)
      - height: |
          [[[
            if (states["media_player.music_and_tv"].state == "playing") {
              return '280px'
            } else if (states["media_player.music_and_tv"].state == "paused") {
              return '280px'
            } else {
              return '180px'
            }
          ]]]
      - width: 100vw
      - overflow: hidden
      - position: |
          [[[
            if (states["input_boolean.debug_ui"].state == "on") {
              return 'static'
            } else {
              return 'fixed'
            }
          ]]]
      - margin: 0
      - bottom: 0
      - left: 0
      - z-index: 1
      - border-radius: 20px 20px 0px 0px
      - box-shadow: >-
          rgba(14, 30, 37, 0.12) 0px 2px 4px 0px, rgba(14, 30, 37, 0.32) 0px
          2px 16px 0px;
    img_cell:
      - position: absolute
      - top: 20%
      - left: 40%
      - overflow: visible
    label:
      - text-align: left
      - font-size: 18px
      - font-weight: 500
      - justify-self: start
      - align-self: start
      - overflow: visible
      - color: var(--contrast20)
    name:
      - text-align: left
      - font-size: 12px
      - justify-self: start
      - align-self: start
      - overflow: visible
      - color: var(--contrast20)
    custom_fields:
      bar:
        - justify-self: start
        - align-self: start
        - margin-top: 10px
        - width: 100%
        - height: |
            [[[
              if (entity.state == 'on') {
                return '12px';
              } else {
                return '0px';
              }
            ]]]
        - background: var(--contrast1)
        - border-radius: 24px
      rem:
        - justify-self: start
        - font-size: 14px
        - font-weight: 600
        - align-self: end
        - height: |
            [[[
              if (entity.state == 'on') {
                return '27px';
              } else {
                return '0px';
              }
            ]]]
      icon1:
        - justify-self: end
        - align-self: start
        - width: 24px
        - color: var(--contrast20)
    hold_action:
      action: more-info
