---
#
custom_card_mediaplayer_tv:
  template: setup
  icon: mdi:play
  label: |
    [[[
      if (states[ entity.entity_id ].attributes.active_child == "media_player.playstation_5") {
        return 'Playstation'
      } else if (states[ entity.entity_id ].attributes.active_child == "media_player.steam_jlnbln") {
        return 'Steam'
      } else if (states[ entity.entity_id ].attributes.active_child == "media_player.plex_bedroom") {
        return 'Plex'
      } else {
        return states[entity.entity_id].attributes.app_name
      }
    ]]]
  name: |
    [[[
      if (states[ entity.entity_id ].attributes.active_child == "media_player.playstation_5") {
        return states["sensor.ps5_343_activity"].attributes.players
      } else if (states[ entity.entity_id ].attributes.active_child == "media_player.steam_jlnbln") {
        return 'jlnbln'
      } else if (states[ entity.entity_id ].attributes.active_child == "media_player.plex_bedroom") {
        return states[ entity.entity_id ].attributes.media_series_title
      } else {
        if (states[ entity.entity_id ].attributes.media_artist != null ) {
          return states[ entity.entity_id ].attributes.media_artist
        } else {
          return "Streaming"
        }
      }
    ]]]
  show_label: true
  show_state: true
  state_display: |
    [[[
      if (entity.state == 'off') {
        return 'Nothing Playing'
      } else {
        return states[entity.entity_id].attributes.media_title
      }
    ]]]
  styles:
    grid:
      - grid-template-areas: |
          'app_icon l i'
          's s s'
          'n n n'
      - grid-template-columns: min-content 1fr
      - grid-template-rows: min-content min-content min-content
      - column-gap: 10px
      - row-gap: 3px
    label:
      - justify-self: start
      - align-self: start
      - font-weight: 600
      - z-index: 1
      - font-size: 1rem
      - margin-top: 5px
    card:
      - padding: 15px
    icon:
      - height: 15px
      - width: 15px
      - color: var(--contrast16)
      - bottom: 4px
      - z-index: 1
    img_cell:
      - align-self: start
      - height: 15px
      - width: 15px
      - background: var(--contrast4)
      - border-radius: 6px
      - padding: 5px
      - z-index: 1
    name:
      - justify-self: start
      - align-self: end
      - color: var(--contrast16)
      - font-weight: 300
      - font-size: 0.9rem
      - z-index: 1
    state:
      - justify-self: start
      - font-weight: 700
      - font-size: 15px
      - z-index: 1
    custom_fields:
      app_icon:
        - width: 25px
        - height: 25px
        - margin-bottom: 20px
        - align-self: start
      background_cover:
        - position: absolute
        - left: 50%
        - bottom: 1px
        - border-radius: 1000px
        - transform: scale(1.3)
        - width: 110%
        - opacity: 80%
        - height: 13rem
        - background: |
            [[[
              if (states[entity.entity_id].attributes.active_child == "media_player.playstation_5") {
                return 'center / cover no-repeat url("' + states["sensor.ps5_343_activity"].attributes.title_image + '")';
              } else if (states[ entity.entity_id ].attributes.active_child == "media_player.steam") {
                return 'center / cover no-repeat url("' + states["sensor.steam_76561197981585794"].attributes.game_image_main + '")';
              } else if ( entity.entity_id == "media_player.steam") {
                return 'center / cover no-repeat url("' + states["sensor.steam_76561197981585794"].attributes.game_image_main + '")';
              } else {
                if (entity.attributes.entity_picture == undefined ){
                  if (states[ entity.entity_id ].attributes.media_artist == "Rocket League Esports") {
                    return 'center / cover no-repeat url("/local/images/rlesports.jpg")'
                  } else {
                    return 'center / cover no-repeat url("/local/images/abstract-gif-colors.gif")'
                  }
                } else {
                  return 'center / cover no-repeat url("' + states[entity.entity_id].attributes.entity_picture + '")';
                }
              }
            ]]]
  state:
    - value: playing
      icon: |
        [[[
          if (states[entity.entity_id].attributes.active_child == "media_player.playstation_5") {
            return 'mdi:controller'
          } else if (states[entity.entity_id].attributes.active_child == "media_player.steam_jlnbln") {
            return 'mdi:controller'
          } else {
            return 'mdi:pause'
          }
        ]]]
  custom_fields:
    background_cover: ""
    app_icon: |
      [[[
        if (states[ entity.entity_id ].attributes.active_child == "media_player.playstation_5") {
          return '<ha-icon icon="mdi:sony-playstation"></ha-icon>'
        } else if (states[ entity.entity_id ].attributes.active_child == "media_player.steam_jlnbln") {
          return '<ha-icon icon="mdi:steam"></ha-icon>'
        } else if (states[ entity.entity_id ].attributes.active_child == "media_player.plex_bedroom") {
          return '<ha-icon icon="mdi:plex"></ha-icon>'
        } else {
          if (entity.attributes.app_name == "YouTube") {
            return '<ha-icon icon="mdi:youtube-tv"></ha-icon>';
          } else if (entity.attributes.app_name == "Netflix") {
            return '<ha-icon icon="mdi:netflix"></ha-icon>';
          } else if (entity.attributes.app_name == "Plex") {
            return '<ha-icon icon="mdi:plex"></ha-icon>';
          } else {
            return '<ha-icon icon="mdi:television-guide"></ha-icon>';
          }
        }
      ]]]
