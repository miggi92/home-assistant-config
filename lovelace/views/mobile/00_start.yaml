---
title: Home
path: start
icon: mdi:home
type: sections
max_columns: 3
header:
  layout: center
  badges_position: top
  card:
    type: markdown
    text_only: true
    content: |-
      # Hallo {{ user }}
      {% if states('binary_sensor.morgen') == 'on' %}
      {{ states('input_text.ai_morning_briefing') }}
      {% endif %}
      {{ states('input_text.klima_analyse') }}
badges:
  - type: custom:mushroom-template-badge
    entity: alarm_control_panel.alarmo
    icon: |-
      {% set alarm_mode = states(entity) %}
      {% if alarm_mode == 'armed_home' %}
        mdi:shield-account
      {% elif alarm_mode == 'armed_away' %}
        mdi:shield-lock
      {% elif alarm_mode == 'armed_vacation' %}
        mdi:palm-tree
      {% elif alarm_mode == 'armed_night' %}
        mdi:shield-moon
      {% elif alarm_mode == 'arming' %}
        mdi:shield
      {% else %}
        mdi:shield-off
      {% endif %}
    tap_action:
      action: more-info
  - type: custom:mushroom-template-badge
    entity: weather.home
    icon: >
      {% set state = states(entity) %}
      {% set icon_name = state | replace('partlycloudy', 'partly-cloudy') | replace('clear-night', 'night') %}
      mdi:weather-{{ icon_name }}
    label: "{{ state_attr(entity, 'friendly_name') }}"
    content: "{{ state_attr(entity, 'temperature') }} {{ state_attr(entity, 'temperature_unit') }}"
    tap_action:
      action: more-info
  - type: custom:mushroom-template-badge
    icon: mdi:message-badge-outline
    tap_action:
      action: navigate
      navigation_path: notification
  - type: custom:mushroom-template-badge
    icon: mdi:medication
    color: red
    tap_action:
      action: navigate
      navigation_path: medication
  - type: custom:mushroom-template-badge
    icon: mdi:lightbulb
    color: >
      {% if states(entity) | int == 0 %}
        grey
      {% else %}
        yellow
      {%endif%}
    entity: number.count_lights_on
    tap_action:
      action: navigate
      navigation_path: lights
  - type: custom:decluttering-card
    template: temperature_badge_template
    variables:
      - entity: sensor.wohnungstemperatur
  - type: custom:decluttering-card
    template: humidity_badge_template
    variables:
      - entity: sensor.wohnungsfeuchtigkeit
  - type: custom:decluttering-card
    template: motion_badge_template
    variables:
      - entity: binary_sensor.bewegungssensoren
  - type: entity
    show_name: true
    show_state: true
    show_icon: true
    entity: sensor.nachste_abholung
    show_entity_picture: false
  - type: custom:decluttering-card
    template: timer_badge_template
    variables:
      - entity: timer.nachtlicht
      - icon: mdi:lightbulb-night
    visibility:
      - condition: state
        entity: timer.nachtlicht
        state: "active"
  - type: custom:decluttering-card
    template: timer_badge_template
    variables:
      - entity: sensor.echo_show_nachster_timer
      - icon: mdi:fridge
    visibility:
      - condition: not
        conditions:
          - condition: state
            entity: sensor.echo_show_nachster_timer
            state: unavailable
  - type: custom:decluttering-card
    template: timer_badge_template
    variables:
      - entity: sensor.milos_dot_nachster_timer
      - icon: mdi:sofa
    visibility:
      - condition: not
        conditions:
          - condition: state
            entity: sensor.milos_dot_nachster_timer
            state: unavailable
  - type: custom:decluttering-card
    template: timer_badge_template
    variables:
      - entity: sensor.echo_buro_nachster_timer
      - icon: mdi:office-building
    visibility:
      - condition: not
        conditions:
          - condition: state
            entity: sensor.echo_buro_nachster_timer
            state: unavailable

sections:
  - type: grid
    cards:
      - !include ../../cards/nav-bar.yaml
      - !include ../../cards/residents.yaml
      - !include ../../cards/floorplan.yaml
      - type: conditional
        conditions:
          - entity: sensor.home_aktuelle_warnstufe
            state_not: "0"
        card:
          type: custom:mushroom-template-card
          icon: mdi:cloud-alert
          icon_color: red
          primary: Es gibt aktuelle Wetterwarnungen
          secondary: |-
            Anzahl der Warnungen: {{ state_attr("sensor.home_aktuelle_warnstufe", "warning_count") + state_attr("sensor.home_vorwarnstufe", "warning_count")}}
          card_mod:
            style:
              mushroom-shape-icon$: |
                ha-icon {
                  --icon-animation: surprise 3s ease infinite;
                }
                @keyframes surprise {
                  0%, 20%, 100% { transform: translateY(0); }
                  2.5% { transform: translateY(-6px) rotate(-14deg); }
                  5% { transform: translateY(-6px) rotate(11deg); }
                  7.5% { transform: translateY(-6px) rotate(-8deg); }
                  10% { transform: translateY(-6px) rotate(5deg); }
                  12.5% { transform: translateY(0); }
                  15% { transform: translateY(-3px) }
                }
          tap_action:
            action: navigate
            navigation_path: dwd
  - type: grid
    cards:
      - type: custom:decluttering-card
        template: anniversary_template
        variables:
          - title: Urlaubscountdown
          - picture_url: /local/images/urlaub_header.png
          - path: urlaub
          - icon: mdi:beach
      - type: custom:decluttering-card
        template: anniversary_template
        variables:
          - title: Geburtstage & Jahrestage
          - picture_url: https://www.home-assistant.io/images/lovelace/header-footer/balloons-header.png
          - path: birthday
          - icon: mdi:gift
          - path2: special
      - type: custom:auto-entities
        card:
          type: grid
          columns: 2
          square: false
        card_param: cards
        filter:
          template: >
            {% set ns = namespace(cards=[]) %}
            {% set sources = states.image %}

            {% for i in sources %}
              {% if ('meal' in i.entity_id or 'kita' in i.entity_id or 'mittag' in i.entity_id)
                    and i.state not in ['unavailable', 'unknown'] %}
                {% set text_entity = i.entity_id | replace('image.', 'input_text.') | replace('sensor.', 'input_text.') %}
                {% if 'work' in i.entity_id %}
                    {% set my_icon = 'mdi:briefcase' %}
                {% elif 'kita' in i.entity_id %}
                    {% set my_icon = 'mdi:baby-bottle' %}
                {% else %}
                    {% set my_icon = 'mdi:food' %}
                {% endif %}
                {% set card_config = {
                    "type": "picture-glance",
                    "title": states(text_entity),
                    "image_entity": i.entity_id,
                    "fit_mode": "cover",
                    "entities": [
                      {
                        "entity": text_entity,
                        "name": "Gericht",
                        "icon": my_icon,
                        "show_state": "false"
                      }
                    ],
                  }
                %}
                {% set ns.cards = ns.cards + [card_config] %}
              {% endif %}
            {% endfor %}
            {{ ns.cards }}

  - type: grid
    cards:
      - type: grid
        square: false
        cards:
          - type: custom:decluttering-card
            template: navigation_card_template
            variables:
              - title: Haus
              - icon: mdi:home
          - type: conditional
            conditions:
              - entity: binary_sensor.jemand_in_spanien
                state: "on"
            card:
              type: custom:decluttering-card
              template: navigation_card_template
              variables:
                - title: Spanien
                - icon: mdi:beach
                - nav_path: spain
                - icon_color: red
          - type: custom:decluttering-card
            template: navigation_card_template
            variables:
              - title: Wetter
              - icon: mdi:weather-partly-snowy-rainy
              - nav_path: weather
          - type: custom:decluttering-card
            template: navigation_card_template
            variables:
              - title: Verbrauch
              - nav_path: consumption
              - icon: mdi:transmission-tower-export
              - icon_color: yellow
          - type: custom:decluttering-card
            template: navigation_card_template
            variables:
              - title: Kameras
              - nav_path: cams
              - icon: mdi:cctv
              - icon_color: >-
                  {% if states('switch.security_kameras') == 'on' %}
                  green
                  {% else %}
                  grey
                  {% endif %}
          - type: custom:decluttering-card
            template: navigation_card_template
            variables:
              - title: Einkaufen
              - nav_path: shopping
              - icon: mdi:cart
              - icon_color: cyan
          - type: custom:decluttering-card
            template: navigation_card_template
            variables:
              - title: Kalender
              - nav_path: calendar
              - icon: mdi:calendar
              - icon_color: orange
          - type: custom:decluttering-card
            template: navigation_card_template
            variables:
              - title: Einstellungen
              - nav_path: settings
              - icon: mdi:cog
              - icon_color: purple
          - type: custom:decluttering-card
            template: navigation_card_template
            variables:
              - title: Karten
              - icon: mdi:map-search
              - nav_path: maps

          - type: conditional
            conditions:
              - entity: binary_sensor.workday_sensor
                state: "on"
            card:
              type: custom:decluttering-card
              template: navigation_card_template
              variables:
                - title: Arbeit
                - nav_path: work
                - icon: mdi:briefcase
                - icon_color: green
          - type: conditional
            conditions:
              - entity: binary_sensor.milo_kita
                state: "on"
            card:
              type: custom:decluttering-card
              template: navigation_card_template
              variables:
                - title: Kita
                - icon: mdi:baby
                - nav_path: kita
          - type: custom:decluttering-card
            template: navigation_card_template
            variables:
              - title: Auto
              - nav_path: car
              - icon: mdi:car
              - icon_color: orange
          - type: custom:decluttering-card
            template: navigation_card_template
            variables:
              - title: Multimedia
              - nav_path: multimedia
              - icon: mdi:multimedia
              - icon_color: purple
          - type: custom:decluttering-card
            template: navigation_card_template
            variables:
              - title: Sport
              - nav_path: sport
              - icon: mdi:basketball
              - icon_color: yellow
          - type: custom:decluttering-card
            template: navigation_card_template
            variables:
              - title: Fl√ºge
              - icon: mdi:airplane
              - nav_path: flights
          - type: custom:state-switch
            entity: user
            states:
              Miguel:
                type: custom:decluttering-card
                template: navigation_card_template
                variables:
                  - title: Netzwerk
                  - nav_path: network
                  - icon: mdi:network
                  - icon_color: red
