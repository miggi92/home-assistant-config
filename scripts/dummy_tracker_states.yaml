---
# Dummy Tracker states
dummy_tracker_states:
  alias: "Update all dummy trackers"
  sequence:
    - repeat:
        for_each:
          - person_id: "milo"
            select_entity: "input_select.milo_person_sync"
          - person_id: "maja"
            select_entity: "input_select.maja_person_sync"
          - person_id: "finn"
            select_entity: "input_select.finn_unterwegs"
        sequence:
          - choose:
              - alias: "Handle person home"
                conditions:
                  - condition: template
                    value_template: "{{ is_state('input_boolean.' ~ repeat.item.person_id ~ '_home', 'on') }}"
                sequence:
                  - action: device_tracker.see
                    alias: "Set tracker to home"
                    data:
                      dev_id: "{{ repeat.item.person_id }}_dummy_tracker"
                      location_name: "home"
                      gps:
                        - !secret home_lat
                        - !secret home_long
              - alias: "Handle person alone while being home"
                conditions:
                  - condition: template
                    value_template: "{{ is_state(repeat.item.select_entity, 'alleine') }}"
                  - condition: template
                    value_template: "{{ is_state('device_tracker.' ~ repeat.item.person_id ~ '_dummy_tracker', 'home') }}"
                sequence:
                  - action: device_tracker.see
                    alias: "Force not_home if alone and previously home"
                    data:
                      dev_id: "{{ repeat.item.person_id }}_dummy_tracker"
                      location_name: "not_home"
              - alias: "Handle person not home and not alone"
                conditions:
                  - condition: template
                    value_template: "{{ is_state('input_boolean.' ~ repeat.item.person_id ~ '_home', 'off') }}"
                  - condition: template
                    value_template: "{{ is_state(repeat.item.select_entity, 'alleine') == false }}"
                sequence:
                  - action: device_tracker.see
                    alias: "Set tracker to not_home"
                    data:
                      dev_id: "{{ repeat.item.person_id }}_dummy_tracker"
                      location_name: "not_home"
