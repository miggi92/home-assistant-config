---
# Make snapshots of camera and send it
send_cam_snaps:
  icon: mdi:camera
  alias: "Snapshots von Kameras senden"
  sequence:
    - variables:
        flur_timestamp: '{{ state_attr("camera.flurcam", "friendly_name") }}_{{ now().strftime("%Y%m%d-%H%M%S") }}'
        koerbchen_timestamp: '{{ state_attr("camera.koerbchen", "friendly_name") }}_{{ now().strftime("%Y%m%d-%H%M%S") }}'
        start: "{{ now() }}"
    - variables:
        flur_pic_path: "{{ flur_timestamp }}.jpg"
        koerbchen_pic_path: "{{ koerbchen_timestamp }}.jpg"
    - if:
        condition: state
        entity_id: switch.flur_cam_stecker
        state: "on"
      then:
        - action: camera.snapshot
          target:
            entity_id: camera.flurcam
          data:
            filename: "/config/www/cams/{{ flur_pic_path }}"
        - event: cam_event
          event_data:
            event: Cam check
            starts: "{{ start }}"
            ends: "{{ now() }}"
            summary: "Aktuelles Kamerabild"
            key_frame: "/local/cams/{{ flur_pic_path }}"
            camera: camera.flurcam
        - action: script.notify_engine
          data:
            title: "ðŸ“· Flurkamera ðŸ“¹"
            value1: "Aktuelles Bild"
            who: "home"
            tag_id: "information"
            photo:
              path: "/config/www/cams/{{ flur_pic_path }}"
              caption: "Flur Kamera"
    - if:
        condition: state
        entity_id: switch.kamera_steckdose_wz
        state: "on"
      then:
        - action: camera.snapshot
          target:
            entity_id: camera.korbchen
          data:
            filename: "/config/www/cams/{{ koerbchen_pic_path }}"
        - event: cam_event
          event_data:
            event: Cam check
            starts: "{{ start }}"
            ends: "{{ now() }}"
            summary: "Aktuelles Kamerabild"
            key_frame: "/local/cams/{{ koerbchen_pic_path }}"
            camera: camera.korbchen
        - action: script.notify_engine
          data:
            title: "ðŸ“· WZ Kamera ðŸ“¹"
            value1: "Aktuelles Bild"
            who: "home"
            tag_id: "information"
            photo:
              path: "/config/www/cams/{{ koerbchen_pic_path }}"
              caption: "WZ Kamera"
